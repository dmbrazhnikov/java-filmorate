CREATE TABLE IF NOT EXISTS ratings (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name VARCHAR NOT NULL
);

CREATE TABLE IF NOT EXISTS genres (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name VARCHAR NOT NULL
);

CREATE TABLE IF NOT EXISTS films (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name VARCHAR NOT NULL,
	description VARCHAR(200),
	release_date DATE,
	duration_minutes INTEGER,
	rating_id INTEGER REFERENCES ratings (id) ON DELETE RESTRICT
);

CREATE TABLE IF NOT EXISTS film_genre (
	film_id INTEGER REFERENCES films (id) ON DELETE CASCADE,
	genre_id INTEGER REFERENCES genres (id) ON DELETE CASCADE,
	PRIMARY KEY (film_id, genre_id)
);

CREATE TABLE IF NOT EXISTS users (
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	login VARCHAR NOT NULL,
	name VARCHAR,
	email VARCHAR NOT NULL,
	birth_date DATE
);

CREATE TABLE IF NOT EXISTS film_user_like (
	film_id INTEGER REFERENCES films (id) ON DELETE CASCADE,
	user_id INTEGER REFERENCES users (id) ON DELETE CASCADE,
	PRIMARY KEY (film_id, user_id)
);

CREATE TABLE IF NOT EXISTS friendship_status (
	id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	name VARCHAR NOT NULL
);

CREATE TABLE IF NOT EXISTS user_friendship (
	user_id INTEGER REFERENCES users (id) ON DELETE CASCADE,
	friend_user_id INTEGER REFERENCES users (id) ON DELETE CASCADE,
	status_id INTEGER NOT NULL REFERENCES friendship_status (id) ON DELETE RESTRICT,
	last_updated TIMESTAMP,
	PRIMARY KEY (user_id, friend_user_id)
);